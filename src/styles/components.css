/* ===========================================
   THE GREY — components.css
   MTG size + crisp edge/shadow
   Hand ribbon fixed, centered, no clipping
   iOS/Safari safe; accurate pick-up
   =========================================== */

/* ---------- Theme tokens ---------- */
:root{
  --bg:#F3EEE5;
  --panel:#FFF;
  --panel-soft:#F9F6F0;
  --ink:#2a2a2a;
  --muted:#777;
  --chip:#f2e7d0;
  --chip-ink:#945c00;

  /* MTG ratio ≈ 3.5/2.5 */
  --card-ratio: 1.4;
  --card-w: 220px;
  --card-h: calc(var(--card-w) * var(--card-ratio));

  --radius: 18px;
  --shadow: 0 6px 20px rgba(0,0,0,.08);

  /* Hold-to-preview zoom */
  --preview-scale: 3; /* 300% */
}

*{ box-sizing:border-box; }

html, body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font:16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
  /* keep fixed children truly fixed on iOS */
  transform:none !important;
  -webkit-transform:none !important;
  overflow:visible !important;
}

/* Leave room for the fixed hand tray */
body{
  padding-bottom: calc(var(--card-h) + 28px + env(safe-area-inset-bottom, 0)) !important;
}

/* ---------- Shell panels ---------- */
.wrap{ max-width:1200px; margin:24px auto 160px; padding:0 16px; }
.zone{
  background:var(--panel); border-radius:14px; box-shadow:var(--shadow);
  padding:18px; margin:12px 0;
  position:relative; z-index:100; overflow:visible !important;
}
.zone .title{ font-weight:600; color:#594f43; margin:0 0 8px; }

/* ---------- Aetherflow chips ---------- */
.costCell{ display:flex; justify-content:center; }
.costChip{
  display:inline-flex; align-items:center; justify-content:center;
  width:28px; height:28px; border-radius:999px;
  background:var(--chip); color:var(--chip-ink); font-weight:600;
  box-shadow: inset 0 1px 0 #fff8, 0 1px 2px rgba(0,0,0,.06);
}

/* ---------- Base Card ---------- */
.card{
  width:var(--card-w); height:var(--card-h);
  position:relative;
  border-radius:var(--radius);
  background:linear-gradient(#fff,#faf8f4);
  background-clip:padding-box;
  box-shadow:var(--shadow);
  transition:transform .18s ease, box-shadow .18s ease;
  transform-origin:center center;
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
  will-change:transform, box-shadow;
}
.card::before{
  content:"";
  position:absolute; inset:0;
  border-radius:inherit;
  box-shadow:inset 0 0 0 1px #e9e2d7;
  pointer-events:none;
}

/* Hover and drag states */
.card:hover:not(.is-dragging):not(.is-previewing){
  transform:translateY(-14px) scale(1.02);
  box-shadow:0 10px 26px rgba(0,0,0,.12);
}

/* ---------- Ribbon (hand) ---------- */
.ribbon-wrap{
  position:fixed !important;
  left:50%; bottom:env(safe-area-inset-bottom,12px);
  transform:translateX(-50%);
  display:flex; justify-content:center; align-items:flex-end;
  width:100%; max-width:100vw;
  background:transparent !important;
  overflow:visible !important;
  pointer-events:none;
  z-index:2147483646 !important;
  isolation:isolate;
}
.ribbon{
  display:flex; align-items:flex-end; justify-content:center;
  gap:0; overflow:visible !important; pointer-events:auto;
}
.ribbon .card{
  margin-left:-60px; transform:translateY(8px);
  transition:transform 120ms ease;
  pointer-events:auto;
  will-change:transform;
}
.ribbon .card:first-child{ margin-left:0; }

/* Lift/fan */
.ribbon .card:hover:not(.is-dragging):not(.is-previewing),
.ribbon .card.is-pressing{
  transform:translateY(-14px) scale(1.02);
  filter:drop-shadow(0 8px 16px rgba(0,0,0,.4));
  z-index:10;
}

/* ---------- Drag & Preview States ---------- */
.card.is-dragging{
  position:fixed; left:0; top:0;
  transform:translate3d(var(--drag-x,0px), var(--drag-y,0px),0) scale(1.02);
  filter:drop-shadow(0 12px 24px rgba(0,0,0,.3));
  cursor:grabbing;
  transition:none !important;
  z-index:2147483001;
}

.card.is-previewing{
  z-index:2147483000;
  transform:translateY(-20px) scale(var(--preview-scale)) !important;
  filter:drop-shadow(0 18px 40px rgba(0,0,0,.4));
  transition:transform 180ms ease-out;
  pointer-events:none !important;
  will-change:transform, filter;
}

/* ---------- Drag Layer ---------- */
.drag-layer{
  position:fixed;
  inset:0;
  z-index:2147483647 !important;
  pointer-events:none !important;
}

/* ---------- Prevent clipping anywhere ---------- */
.wrap, .zone, .ribbon, .ribbon-wrap, #playerSlots, #aiSlots{
  overflow:visible !important;
  -webkit-mask:none !important;
  mask:none !important;
  clip-path:none !important;
}

/* ---------- Mobile scaling ---------- */
@media (max-width:768px){
  :root{ --card-w:min(38vw,220px); --card-h:calc(var(--card-w)*var(--card-ratio)); }
  .ribbon .card{ margin-left:-48px; transform:translateY(6px); }
  .ribbon .card:hover{ transform:translateY(-10px) scale(1.02); }
}

/* ---------- Instant pulse ---------- */
@keyframes goldPulse {
  0% { box-shadow:0 0 0 0 rgba(255,210,90,.45); opacity:1; }
  70%{ box-shadow:0 0 24px 10px rgba(255,210,90,.18); opacity:.85; }
  100%{ box-shadow:0 0 0 0 rgba(255,210,90,0); opacity:0; }
}
.card.is-instant.pulsing::after{
  content:"";
  position:absolute; inset:-2px;
  border-radius:inherit; pointer-events:none;
  animation:goldPulse 1.4s ease-out infinite;
}

/* ---------- End Turn button alignment ---------- */
#btnDraw{ display:none !important; }
#btnEnd{
  position:fixed !important;
  right:calc(18px + 54px + 12px);
  bottom:86px;
  z-index:51 !important;
}