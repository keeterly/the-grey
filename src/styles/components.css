/* =========================================================
   GREY — components.css
   MTG dimensions • clean edge/shadow
   Hand ribbon fixed (no cropping) • iOS-safe
   ========================================================= */

/* ---------- Theme tokens ---------- */
:root{
  --bg:#F3EEE5;
  --panel:#FFF;
  --panel-soft:#F9F6F0;
  --ink:#2a2a2a;
  --muted:#777;
  --chip:#f2e7d0;
  --chip-ink:#945c00;

  /* MTG ratio ≈ 3.5 / 2.5 = 1.4 */
  --card-ratio: 1.4;
  --card-w: 220px;                                 /* desktop base width */
  --card-h: calc(var(--card-w) * var(--card-ratio));

  --radius: 16px;
  --shadow: 0 6px 20px rgba(0,0,0,.08);
}

*{ box-sizing:border-box; }

html, body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font:16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
}

/* Leave space so content never sits under the fixed hand tray */
body{
  padding-bottom: calc(var(--card-h) + 72px + env(safe-area-inset-bottom, 0)) !important;
}

/* ---------- Shell panels ---------- */
.wrap{ max-width:1200px; margin:24px auto 160px; padding:0 16px; }
.zone{
  background:var(--panel); border-radius:14px; box-shadow:var(--shadow);
  padding:18px; margin:12px 0;
}
.zone .title{ font-weight:600; color:#594f43; margin:0 0 8px; }

/* ---------- Aetherflow chips ---------- */
.costCell{ display:flex; justify-content:center; }
.costChip{
  display:inline-flex; align-items:center; justify-content:center;
  width:28px; height:28px; border-radius:999px;
  background:var(--chip); color:var(--chip-ink); font-weight:600;
  box-shadow: inset 0 1px 0 #fff8, 0 1px 2px rgba(0,0,0,.06);
}

/* ============================
   CARD + MTG STYLE
   ============================ */
.card{ width: var(--card-w) !important; height: var(--card-h) !important; }
.slotCell{ width: var(--card-w) !important; height: var(--card-h) !important; }

.card{
  position: relative;
  border-radius:18px;
  background: linear-gradient(#fff, #faf8f4);
  box-shadow: var(--shadow);
  transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
  filter: none;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}
.card::before{
  content:"";
  position:absolute; inset:0;
  border-radius:inherit;
  box-shadow: inset 0 0 0 1px #e9e2d7;
  pointer-events:none;
}
.card::after{ content:none !important; }

/* Hover lift */
.card:hover:not(.is-dragging){
  transform: translateY(-14px) scale(1.02);
  box-shadow: 0 10px 26px rgba(0,0,0,.12);
}

/* Card text/content */
.card .cName{ font-weight:700; letter-spacing:.2px; }
.card .cType{ font-size:12px; color:var(--muted); }

/* ============================
   RIBBON / HAND
   ============================ */
.ribbon-wrap{
  position: fixed;
  left: 50%;
  bottom: 12px;
  transform: translateX(-50%);
  display: flex;
  justify-content: center;
  align-items: flex-end;
  width: 100%;
  max-width: 100vw;
  height: calc(var(--card-h) + 80px) !important;
  pointer-events: none;
  z-index: 2147483646 !important;
  overflow: visible !important;
  isolation: isolate;
}
.ribbon{
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: 0;
  pointer-events: auto;
  overflow: visible !important;
  padding-bottom: 12px;
}

/* Cards in hand fan and overlap */
.ribbon .card{
  position: relative;
  margin-left: -72px !important; /* tighter spacing */
  transform: translateY(10px);
  transition: transform 120ms ease, filter 120ms ease;
  transform-origin: center center;
  will-change: transform;
  pointer-events: auto;
}
.ribbon .card:first-child{ margin-left: 0; }

/* Hover/drag effects */
.ribbon .card:hover:not(.is-dragging):not(.is-previewing){
  transform: translateY(-14px) scale(1.02);
  filter: drop-shadow(0 8px 16px rgba(0,0,0,.4));
}
.ribbon .card.is-pressing{
  transform: translateY(-14px) scale(1.02) !important;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,.4)) !important;
  transition: none !important;
}
.card.is-dragging{ transition: none !important; }

/* ---------- REAL-CARD PREVIEW (hold to zoom) ---------- */
:root { --preview-scale: 2.5; }  /* 250% zoom */

.card.is-previewing{
  position: relative;
  z-index: 2147483000;
  transform-origin: 50% 50% !important;
  transform: translate3d(0,-14px,0) scale(var(--preview-scale)) !important;
  filter: drop-shadow(0 16px 36px rgba(0,0,0,.35)) !important;
  transition: transform 0.25s cubic-bezier(.22,1,.36,1);
  backface-visibility: hidden;
  will-change: transform, filter;
  contain: layout paint;
}
.card:hover.is-previewing,
.card:hover.is-dragging{
  transform: none;
  filter: none;
}

/* Drag card follows pointer smoothly */
.card.is-dragging{
  position: fixed;
  left: 0; top: 0;
  transform: translate3d(var(--drag-x,0px),var(--drag-y,0px),0) scale(1.02);
  filter: drop-shadow(0 12px 24px rgba(0,0,0,.32));
  cursor: grabbing;
  transition: none !important;
  z-index: 2147483001 !important;
}

/* ---------- HUD / BUTTONS ---------- */
.aeGem{
  position:fixed; right:18px; bottom:86px; z-index:40;
  width:54px; height:54px; border-radius:14px;
  background:radial-gradient(ellipse at 30% 25%,#ffd67a,#f6b441 60%,#d38d1f 100%);
  box-shadow:0 10px 26px rgba(0,0,0,.18), inset 0 2px 6px #fff8;
  display:flex; align-items:center; justify-content:center; font-weight:800;
}
.fabDial{ position:fixed; right:18px; top:18px; z-index:50; display:flex; flex-direction:column; gap:12px; }
.fab{ width:40px; height:40px; border-radius:999px; border:0; background:#fff;
     box-shadow:var(--shadow); cursor:pointer; font-weight:700; }

/* Remove draw icon */
#btnDraw{ display:none !important; }

/* Move End Turn to right of gem */
#btnEnd{
  position: fixed !important;
  right: calc(18px + 54px + 12px) !important;
  bottom: 86px !important;
  z-index: 51 !important;
}

/* Keep Reset near End Turn */
#btnReset{
  position: fixed !important;
  right: calc(18px + 54px + 12px + 48px + 10px) !important;
  bottom: 86px !important;
  z-index: 51 !important;
}

/* ---------- Z-index Safety ---------- */
.drag-layer{
  position: fixed;
  inset: 0;
  z-index: 2147483647 !important;
  pointer-events: none !important;
}
.wrap, .zone, #topLog, .hudRow, .fabDial, .leftDock, .aetherGem{
  position: relative; z-index: 100 !important; overflow: visible !important;
}
#playerSlots, #aiSlots, .slots, .zone{ overflow: visible !important; }

/* ---------- Responsive ---------- */
@media (max-width: 768px){
  .ribbon .card{ margin-left:-60px !important; transform: translateY(8px); }
  .ribbon .card:hover,
  .ribbon .card.is-dragging{ transform: translateY(-10px) scale(1.02); }
  .ribbon-wrap{ bottom: 6px; }
}

/* ---------- Anti-mask / Safe-area fixes ---------- */
html, body, .wrap{
  transform:none !important;
  -webkit-transform:none !important;
  overflow:visible !important;
}

/* === HAND CLIPPING HOT-FIX === */
body{
  padding-bottom: calc(var(--card-h) + 84px + env(safe-area-inset-bottom,0)) !important;
}
.ribbon-wrap{
  bottom: calc(env(safe-area-inset-bottom,0) + 8px) !important;
  height: calc(var(--card-h) + 80px) !important;
  overflow: visible !important;
}
.ribbon{
  overflow-y: visible !important;
  overflow-x: auto !important;
  align-items: flex-end;
  padding-bottom: 12px;
}
#app, main, .wrap, .zone, #topLog, .hudRow, .fabDial, .leftDock, .aetherGem,
#playerSlots, #aiSlots, .slots{ overflow: visible !important; }
.drag-layer{ z-index:2147483647 !important; pointer-events:none !important; }
.ribbon-wrap{ z-index:2147483646 !important; }

@media (max-width:480px){
  body{
    padding-bottom: calc(var(--card-h) + 96px + env(safe-area-inset-bottom,0)) !important;
  }
  .ribbon-wrap{
    height: calc(var(--card-h) + 92px) !important;
    bottom: calc(env(safe-area-inset-bottom,0) + 6px) !important;
  }
}