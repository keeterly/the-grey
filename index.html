
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>The Grey — Lite PWA</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b0d10">
<style>
:root{--bg:#0b0d10;--panel:#0e1218;--ink:#efece7;--muted:#b9b4ac;--line:#1e2631;--accent:#d7b77a;}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;-webkit-tap-highlight-color:transparent}
.wrap{padding:max(env(safe-area-inset-top),12px) 12px 12px;max-width:900px;margin:0 auto}
h1{font-size:20px;margin:0 0 8px} .accent{color:var(--accent);letter-spacing:.15em;font-weight:800}
.zone{background:#0e1218;border:1px solid #1c2836;border-radius:14px;padding:10px;margin:8px 0}
.row{display:flex;gap:8px;flex-wrap:wrap}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#111621;border:1px solid #223043;font-size:12px}
button{background:linear-gradient(180deg,#151c27,#0e141d);color:#efece7;border:1px solid #1e2631;border-radius:12px;padding:10px 12px;font-size:14px}
.card{background:#111621;border:1px solid #23344a;border-radius:12px;padding:8px;min-width:170px}
.small{font-size:12px;color:#b9b4ac}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.slot{background:#0c1118;border:1px dashed #33465d;border-radius:12px;min-height:120px;padding:8px}
.tag{font-size:10px;padding:2px 6px;border-radius:6px;border:1px solid #2d3f56;background:#0b111a;margin-right:4px}
.hand{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px}
.log{background:#0b111a;border:1px solid #1c2a3a;border-radius:10px;padding:8px;height:150px;overflow:auto;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1><span class="accent">VENIA</span> × The Grey — Lite</h1>
  <div class="zone">
    <div class="row">
      <span class="pill">You ♥ <b id="hp">3</b></span>
      <span class="pill">AI ♥ <b id="aiHp">3</b></span>
      <span class="pill">⚡ <b id="aether">0</b></span>
      <span class="pill">Deck <b id="deck">0</b></span>
      <span class="pill">Discard <b id="disc">0</b></span>
    </div>
    <div class="row" style="margin-top:6px">
      <button id="drawBtn">Draw</button>
      <button id="endBtn">End Turn</button>
      <button id="resetBtn">Reset</button>
    </div>
  </div>

  <div class="zone">
    <b>Your Hand</b>
    <div id="hand" class="hand"></div>
  </div>

  <div class="zone row">
    <div style="flex:1;min-width:260px">
      <b>Your Slots</b>
      <div class="grid" id="slots"></div>
    </div>
    <div style="flex:1;min-width:260px">
      <b>AI Slots</b>
      <div class="grid" id="ais"></div>
    </div>
  </div>

  <div class="zone">
    <b>Log</b>
    <div id="log" class="log"></div>
  </div>
</div>
<script>
document.addEventListener('touchstart', ()=>{}, {passive:true});
function log(m){ const el=document.getElementById('log'); el.innerHTML+=`<div>${m}</div>`; el.scrollTop=el.scrollHeight; }
function uid(){ return Math.random().toString(36).slice(2,9); }
function shuf(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

const BASE = [
  {n:"Spark",t:"Instant",v:1,txt:"Deal 1 dmg",eff:"spark"},
  {n:"Spark",t:"Instant",v:1,txt:"Deal 1 dmg",eff:"spark"},
  {n:"Shield",t:"Instant",v:1,txt:"Prevent 1 dmg",eff:"shield"},
  {n:"Channel",t:"Utility",v:1,txt:"+2⚡ (discard 1)",eff:"channel"},
  {n:"Minor Hex",t:"Spell",v:1,p:2,txt:"After 2: foe discards",eff:"hex"},
  {n:"Minor Hex",t:"Spell",v:1,p:2,txt:"After 2: foe discards",eff:"hex"},
  {n:"Emberbolt",t:"Spell",v:2,p:3,txt:"After 3: deal 2",eff:"ember"},
  {n:"Emberbolt",t:"Spell",v:2,p:3,txt:"After 3: deal 2",eff:"ember"},
  {n:"Channel",t:"Utility",v:1,txt:"+2⚡ (discard 1)",eff:"channel"},
  {n:"Spark",t:"Instant",v:1,txt:"Deal 1 dmg",eff:"spark"}
];

let S;

function makeDeck(){ return shuf(BASE.map(c=>Object.assign({id:uid()},c))); }
function reset(){
  S={hp:3, ai:{hp:3,a:0,deck:makeDeck(),hand:[],disc:[],slots:[null,null,null]}, a:0, deck:makeDeck(), hand:[], disc:[], slots:[null,null,null]};
  for(let i=0;i<4;i++){ draw(); aiDraw(); } render(); log("New game. You go first.");
}
function draw(){
  if(!S.deck.length){ if(!S.disc.length){ log("No cards to draw."); return; } S.deck=shuf(S.disc); S.disc=[]; log("You reshuffle."); }
  S.hand.push(S.deck.pop()); render();
}
function play(i){
  const c=S.hand.splice(i,1)[0];
  if(c.t==="Spell"){
    const s=S.slots.findIndex(x=>!x); if(s<0){ log("No empty slot."); S.hand.push(c); render(); return; }
    S.slots[s]={c,ph:1}; log(`You play ${c.n} to Slot ${s+1}.`);
  }else{ run(c,"you"); S.disc.push(c); }
  render();
}
function channel(i){
  const c=S.hand.splice(i,1)[0]; S.a += c.v; S.disc.push(c); log(`Channel ${c.n} (+${c.v}⚡)`); render();
}
function adv(i){
  const s=S.slots[i]; if(!s) return;
  if(S.a<1){ log("Need 1⚡"); return; }
  S.a-=1; s.ph+=1;
  if(s.ph>=s.c.p){ resolvePlayer(i); }
  render();
}
function resolvePlayer(i){
  const s=S.slots[i]; if(!s) return;
  const c=s.c;
  if(c.eff==="ember"){ S.ai.hp=Math.max(0,S.ai.hp-2); log("Emberbolt hits AI for 2!"); }
  if(c.eff==="hex"){ log("Minor Hex resolves (discard simulated)."); }
  S.disc.push(c); S.slots[i]=null;
}
function run(c,who){
  if(c.eff==="spark"){
    if(who==="you"){ S.ai.hp=Math.max(0,S.ai.hp-1); log("Spark: deal 1 to AI."); }
    else { S.hp=Math.max(0,S.hp-1); log("AI Spark hits you for 1."); }
  }
  if(c.eff==="shield"){
    if(who==="you"){ S.shield=1; log("Shield: prevent next 1 dmg this round."); }
  }
  if(c.eff==="channel"){
    if(who==="you"){
      if(!S.hand.length){ log("No card to discard."); return; }
      const d=S.hand.pop(); S.disc.push(d); S.a+=2; log("Channel: +2⚡ (discard 1).");
    } else {
      if(!S.ai.hand.length) return;
      const d=S.ai.hand.pop(); S.ai.disc.push(d); S.ai.a+=2; log("AI channels +2⚡.");
    }
  }
}
function endTurn(){
  // auto-advance your spells by 1
  S.slots.forEach((s,i)=>{ if(s){ s.ph=Math.min(s.c.p, s.ph+1); if(s.ph===s.c.p) resolvePlayer(i); }});
  render(); log("You end turn."); setTimeout(aiTurn, 300);
}
function aiDraw(){ if(!S.ai.deck.length){ if(!S.ai.disc.length) return; S.ai.deck=shuf(S.ai.disc); S.ai.disc=[]; log("AI reshuffles."); } S.ai.hand.push(S.ai.deck.pop()); }
function aiPlay(){
  // play a spell if possible
  const empty=S.ai.slots.findIndex(x=>!x);
  let idx=-1;
  if(empty>-1){ idx=S.ai.hand.findIndex(x=>x.t==="Spell"); if(idx>-1){ const c=S.ai.hand.splice(idx,1)[0]; S.ai.slots[empty]={c,ph:1}; log(`AI plays ${c.n}.`);} }
  // spark 40%
  const sp=S.ai.hand.findIndex(x=>x.eff==="spark");
  if(sp>-1 && Math.random()<0.4){ const c=S.ai.hand.splice(sp,1)[0]; run(c,"ai"); S.ai.disc.push(c); }
  // channel if can
  const ch=S.ai.hand.findIndex(x=>x.eff==="channel");
  if(ch>-1 && S.ai.hand.length>1){ const c=S.ai.hand.splice(ch,1)[0]; run(c,"ai"); S.ai.disc.push(c); }
  // advance if has aether
  const act=S.ai.slots.map((s,i)=> s? i:-1).filter(i=>i>=0);
  if(act.length && S.ai.a>0){ const t=act[Math.floor(Math.random()*act.length)]; S.ai.a-=1; S.ai.slots[t].ph+=1; log("AI advances a spell."); if(S.ai.slots[t].ph>=S.ai.slots[t].c.p){ const cc=S.ai.slots[t].c; if(cc.eff==="ember"){ S.hp=Math.max(0,S.hp-2); log("AI Emberbolt hits you for 2."); } if(cc.eff==="hex"){ log("AI Hex resolves (discard simulated)."); } S.ai.disc.push(cc); S.ai.slots[t]=null; } }
}
function aiTurn(){ log("— AI Turn —"); aiDraw(); aiPlay(); // auto-advance
  S.ai.slots.forEach((s,i)=>{ if(s){ s.ph=Math.min(s.c.p, s.ph+1); if(s.ph===s.c.p){ const cc=s.c; if(cc.eff==="ember"){ S.hp=Math.max(0,S.hp-2); log("AI Emberbolt hits you for 2."); } if(cc.eff==="hex"){ log("AI Hex resolves (discard simulated)."); } S.ai.disc.push(cc); S.ai.slots[i]=null; } } }); render(); log("AI ends turn."); }

function render(){
  document.getElementById('hp').textContent=S.hp;
  document.getElementById('aiHp').textContent=S.ai.hp;
  document.getElementById('aether').textContent=S.a;
  document.getElementById('deck').textContent=S.deck.length;
  document.getElementById('disc').textContent=S.disc.length;

  const hand=document.getElementById('hand'); hand.innerHTML="";
  S.hand.forEach((c,i)=>{
    const d=document.createElement('div'); d.className="card";
    d.innerHTML = `<div><span class="tag">${c.t}</span></div><div><b>${c.n}</b></div><div class="small">${c.txt}</div>`;
    const p=document.createElement('button'); p.textContent=(c.t==="Spell"?"Play":"Use"); p.onclick=()=>play(i);
    const ch=document.createElement('button'); ch.textContent=`Channel (+${c.v})`; ch.onclick=()=>channel(i);
    const a=document.createElement('div'); a.style.marginTop="6px"; a.appendChild(p); a.appendChild(document.createTextNode(" ")); a.appendChild(ch);
    d.appendChild(a); hand.appendChild(d);
  });

  const slots=document.getElementById('slots'); slots.innerHTML="";
  for(let i=0;i<3;i++){
    const s=S.slots[i]; const div=document.createElement('div'); div.className="slot";
    if(s){ div.innerHTML=`<div><b>${s.c.n}</b></div><div class="small">Phase ${s.ph}/${s.c.p}</div>`; const b=document.createElement('button'); b.textContent="Advance (1⚡)"; b.onclick=()=>adv(i); div.appendChild(b); }
    else{ div.innerHTML=`<div class="small">Empty</div>`; }
    slots.appendChild(div);
  }
  const ais=document.getElementById('ais'); ais.innerHTML="";
  for(let i=0;i<3;i++){
    const s=S.ai.slots[i]; const div=document.createElement('div'); div.className="slot";
    if(s){ div.innerHTML=`<div><b>${s.c.n}</b></div><div class="small">Phase ${s.ph}/${s.c.p}</div>`; }
    else{ div.innerHTML=`<div class="small">Empty</div>`; }
    ais.appendChild(div);
  }
}

document.getElementById('drawBtn').onclick=()=>draw();
document.getElementById('endBtn').onclick=()=>endTurn();
document.getElementById('resetBtn').onclick=()=>reset();

reset();

// PWA SW register (best-effort)
if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('sw.js').catch(()=>{})); }
</script>
</body>
</html>
