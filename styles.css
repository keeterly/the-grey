/* The Grey v2.571 â€” UI/Animation Patch Bundle (styles.css)
   ---------------------------------------------------------
   Paste over your styles.css. Focuses on:
   - Aetherflow slot alignment & title
   - AetherGem numeric fit
   - Trance placeholders (inactive 50% opacity)
   - Hand animation jitter smoothing (pairs with JS FLIP)
   - Card visuals tweaks preserved (type colors, cost bubble, pips)
*/

:root{
  --grey-ink:#111;
  --parchment:#efe7d5;
  --accent-blue:#2c6de7;   /* Spell */
  --accent-green:#2aa65a;  /* Instant */
  --accent-purple:#6a44b8; /* Glyph */
  --shadow: 0 6px 24px rgba(0,0,0,.25);
  --soft: 0 2px 10px rgba(0,0,0,.18);
  --fan-radius: 560px;
  --fan-spread: 32deg;
  --transition-fast: 160ms;
  --transition-med: 220ms;
}

/* Aetherflow Board ------------------------------------------------------- */
.aetherflow-board{
  position: relative;
  display: grid;
  grid-template-columns: repeat(7, minmax(64px, 1fr));
  gap: 10px;
  justify-items: center;
  align-items: center;
  padding: 16px 48px 16px 56px; /* leave room for vertical title */
  margin: 0 auto;
  max-width: 960px;
}

.aetherflow-title{
  position:absolute;
  left: 8px;
  top: 8px;
  bottom: 8px;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  letter-spacing: 3px;
  font-weight: 700;
  font-size: 14px;
  color: rgba(20,12,4,.65);
  display:flex;
  align-items:center;
  text-shadow: 0 1px 0 rgba(255,255,255,.3);
  user-select: none;
}

.aetherflow-slot{
  position: relative;
  width: 100%;
  aspect-ratio: 63/88; /* true MTG proportions */
  border-radius: 8px;
  outline: 2px dashed rgba(20,12,4,.18);
  outline-offset: -4px;
  background: rgba(255,255,255,.35);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
  overflow: visible; /* allow placed card to extend with transforms */
  transform: translateZ(0); /* create own stacking context */
}

.aetherflow-slot.over{
  outline-color: rgba(20,12,4,.45);
  background: rgba(255,255,255,.5);
}

/* River tick (once per turn) */
.aetherflow-board.river-tick .aetherflow-slot::after{
  content:'';
  position:absolute;
  left:-20%;
  top:0;
  width: 140%;
  height: 100%;
  background: radial-gradient(50% 50% at 50% 50%, rgba(80,170,255,.16) 0%, rgba(80,170,255,0) 60%);
  animation: river-sweep 1.1s ease-out forwards;
  pointer-events:none;
}
@keyframes river-sweep{
  from{ transform: translateX(-30%); opacity:.9; }
  to{   transform: translateX(30%); opacity:0; }
}

/* Placed card centers within slot */
.aetherflow-slot > .card{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
}

/* Portrait & Aether Gem -------------------------------------------------- */
.player .portrait{
  position: relative;
  display: flex;
  align-items: center;
  gap: 10px;
}

.player .hearts + .aether-gem{ margin-left: 8px; }

.aether-gem{
  position: relative;
  width: 46px; /* enlarged 2x-ish; adjust if you had base ~24px */
  height: 46px;
  display: grid;
  place-items: center;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.25));
}

.aether-gem svg, .aether-gem canvas{
  width: 100%;
  height: 100%;
  display: block;
}

.aether-gem .aether-gem-value{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  font-weight: 800;
  line-height: 1;
  text-shadow: 0 1px 0 rgba(0,0,0,.35), 0 0 8px rgba(255,255,255,.55);
  user-select: none;
}

/* Trance placeholders under portrait ------------------------------------ */
.player .trance{
  margin-top: 6px;
  display: grid;
  gap: 2px;
  font-size: 12px;
  letter-spacing: .3px;
  color: rgba(0,0,0,.75);
  user-select: none;
}

.trance .trance-level{
  opacity: .5; /* inactive default */
  transition: opacity var(--transition-fast) ease;
  white-space: nowrap;
}

.trance .trance-level.active{
  opacity: 1;
}

/* Hand & Card Fan -------------------------------------------------------- */
.hand{
  position: relative;
  width: 100%;
  min-height: 180px;
  display: grid;
  place-items: end center;
  perspective: 1200px;
}

.hand .card{
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform-origin: bottom center;
  transition:
    transform var(--transition-med) cubic-bezier(.2,.6,.2,1),
    opacity var(--transition-fast) ease;
  will-change: transform;
}

.hand .card.discarding{
  opacity: 0;
  transform: translateY(40px) rotate(6deg) scale(.96);
}

.hand .card.dragging{
  z-index: 10;
  transition: none;
  cursor: grabbing;
}

/* Fan using index() custom prop set by JS or existing layout */
.hand{
  --count: 7; /* fallback */
}
.hand .card{
  --i: 0; /* index */
}
/* Example fan math (no specific colors/styles set) */
.hand.fanned .card{
  /* map --i in [0..count-1] to angle spread around center */
  --middle: calc((var(--count) - 1) / 2);
  --offset: calc(var(--i) - var(--middle));
  --angle: calc((var(--offset) / var(--middle)) * (var(--fan-spread)));
  transform:
    translateX(calc((var(--offset) * 24px)))
    translateY(calc(abs(var(--offset)) * -4px))
    rotate(calc(var(--angle)));
}

/* Card Visual Tweaks ----------------------------------------------------- */
.card .type-line{
  opacity: .95;
}

.card[data-type="SPELL"] .type-line{ color: var(--accent-blue); }
.card[data-type="INSTANT"] .type-line{ color: var(--accent-green); }
.card[data-type="GLYPH"] .type-line{ color: var(--accent-purple); }

/* Cost bubble (top-right) */
.card .cost-bubble{
  position: absolute;
  right: 8px;
  top: 8px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-weight: 800;
  filter: drop-shadow(0 2px 2px rgba(0,0,0,.25));
  background: rgba(255,255,255,.85);
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.2);
}

/* Pips moved below title/type line */
.card .pips{
  position: absolute;
  top: 44px;
  left: 12px;
  display: flex;
  gap: 6px;
}
.card .pip{
  width: 10px;
  height: 10px;
  border-radius: 50%;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.5);
  background: transparent; /* empty circles */
}

/* Accessibility & polish ------------------------------------------------- */
.aetherflow-slot:focus-within{
  outline-color: rgba(0,0,0,.45);
}

@media (max-width: 900px){
  .aetherflow-board{
    grid-template-columns: repeat(7, minmax(44px, 1fr));
    padding-left: 44px;
  }
  .aether-gem{ width: 40px; height: 40px; }
}
